{include '../../layouts/wap/header.html'}
<section class="list_main">
	<div class="news_top">
		<img src="{$top_thumb}" alt=""/>
	</div>
	<div class="tab_box">
		<div class="tab_til">
			<ul data-id="{$id}">
				<li {if $id==419}class="active" {/if}>
					<a href="{myurl name='wap/list, id=>419'}">最新</a>
				</li>
				<li {if $id==421}class="active" {/if}>
					<a href="{myurl name='wap/list, id=>421'}">新闻</a>
				</li>
				<li {if $id==422}class="active" {/if}>
					<a href="{myurl name='wap/list, id=>422'}">公告</a>
				</li>
				<li {if $id==420}class="active" {/if}>
					<a href="{myurl name='wap/list, id=>420'}">活动</a>
				</li>
				<li {if $id==423}class="active" {/if}>
					<a href="{myurl name='wap/list, id=>423'}">攻略</a>
				</li>
			</ul>
		</div>
	</div>
	<div class="news_infor show">
		<div class="loading_enter"></div>
		<div class="news_list">

		</div>
	</div>
</section>
</body>
{include '../../layouts/wap/foot.html'}
<script src="{$smarty.const.STATIC_DOMAIN}3.0/m/js/dropload.min.js?{$smarty.const.VERSION}"></script>
<script>
	$(function() {
		//全局
		var ajaxUrl = '/wap/article/ajax-get-list.html';
		var page = 1;
		var id = $(".tab_til ul").attr("data-id");
//		var isfirst = true;
		var obj = '';
		$(".tab_til li").on("click", function() {
			page = 1;
			$(".dropload-noData").text("");
			$(".news_list").html("");
			//newAjax(obj);
		});
		ajaxList();
		function newAjax(me) {
			$.ajax({
				type: 'GET',
				url: ajaxUrl,
				data: {
					page: page,
					id:id
				},
				dataType: 'json',
				success: function(data) {
					if(data.status === 0) {
						me.noData(false);
						me.unlock();
						if(data.msg.length) {
//							isfirst = false;
							if(page===1){
								$('.news_list').empty();
							}
							page++;
							var result = '';
							for(var i = 0; i < data.msg.length; i++) {
								result += "<div class='list_box'><a href=" + data.msg[i].wapLinkUrl+">"+
										 "<div class='list_left'><img src=" + data.msg[i].thumb+" /></div>"+
										"<div class='list_right'><span class='title'><i>[" +data.msg[i].name+"]</i>"+data.msg[i].title+"</span>"+
										"<span class='time'>"+data.msg[i].created_at+"</span></div></a></div>";
							}
							// 为了测试，延迟1秒加载
							setTimeout(function() {
								$('.news_list').append(result);
								// 每次数据加载完，必须重置
								me.resetload();
							}, 0);
						} else {
							// 锁定
							me.lock();
//								// 无数据
							me.noData(true);
							me.resetload();
//							if(!isfirst) {
								var content=$('.news_list .list_box').html();
								if(content == null || content.length == 0){
									$(".dropload-noData").text("暂无数据");
								}else{
									$(".dropload-noData").text("数据加载完毕");
								}
//								} else {
//									$(".dropload-noData").text("数据加载中");
//								}
								return 0;
							}
						}
					},
					error: function(xhr, type) {

					}
				});
		}
		function ajaxList() {
			$('.news_infor').dropload({
				scrollArea: window,
				loadDownFn: function(me) {
					obj = me
					newAjax(me);
				}
			});
		}
	});

</script>