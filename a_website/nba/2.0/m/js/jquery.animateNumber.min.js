/**
 *  by Mantou qq:676015863
 *  数字滚动插件 v1.0
 */
;
(function($) {
	$.fn.numberAnimate = function(setting) {
		var defaults = {
			speed: 1000,
			num: "",
			iniAnimate: true,
			symbol: '',
			dot: 0
		};
		var setting = $.extend(defaults, setting);
		if($(this).length > 1) {
			alert("just only one obj!");
			return
		}
		if(setting.num == "") {
			alert("must set a num!");
			return
		}
		var nHtml = '<li class="mt-number-animate-dom" data-num="{{num}}">\
			            <span class="mt-number-animate-span">0</span>\
			            <span class="mt-number-animate-span">1</span>\
			            <span class="mt-number-animate-span">2</span>\
			            <span class="mt-number-animate-span">3</span>\
			            <span class="mt-number-animate-span">4</span>\
			            <span class="mt-number-animate-span">5</span>\
			            <span class="mt-number-animate-span">6</span>\
			            <span class="mt-number-animate-span">7</span>\
			            <span class="mt-number-animate-span">8</span>\
			            <span class="mt-number-animate-span">9</span>\
		          	</li>';
		var numToArr = function(num) {
			//			num = parseFloat(num).toFixed(setting.dot);
			if(typeof(num) == 'number') {
				var arrStr = num.toString().split("");
			} else {
				var arrStr = num.split("");
			}
			return arrStr
		};
		var setNumDom = function(arrStr) {
			var shtml = '<ul class="mt-number-animate num">';
			for(var i = 0, len = arrStr.length; i < len; i += 1) {
				if(i != 0 && (len - i) % 3 == 0 && setting.symbol != "" && arrStr[i] != ".") {
					shtml += '<div class="mt-number-animate-dot">' + setting.symbol + '</div>' + nHtml.replace("{{num}}", arrStr[i])
				} else {
					shtml += nHtml.replace("{{num}}", arrStr[i])
				}
			}
			shtml += '</ul>';
			return shtml
		};
		var runAnimate = function($parent) {
			$parent.find(".mt-number-animate-dom").each(function() {
				var self = $(this);
				var num = $(this).attr("data-num");
				num = (num == "." ? 10 : num);
				var spanHei = 3.22125;
				var thisTop = -num * spanHei + "rem";
				if(thisTop != $(this).css("top")) {
					if(setting.iniAnimate) {
						if(!window.applicationCache) {
							$(this).animate({
								top: thisTop
							}, setting.speed)
						} else {
							if($(".num li").length == 1) {
								$(".num li:nth-child(1)").css("margin-left", "15.8rem");
							} else if($(".num li").length == 2) {
								$(".num li:nth-child(1)").css("margin-left", "13.2rem");
							} else if($(".num li").length == 3) {
								$(".num li:nth-child(1)").css("margin-left", "10.6rem");
							} else if($(".num li").length == 4) {
								$(".num li:nth-child(1)").css("margin-left", "8.1rem");
							} else if($(".num li").length == 5) {
								$(".num li:nth-child(1)").css("margin-left", "5.5rem");
							} else if($(".num li").length == 6) {
								$(".num li:nth-child(1)").css("margin-left", "2.9rem");
							} else if($(".num li").length == 7) {
								$(".num li:nth-child(1)").css("margin-left", "0.3rem");
							}
							setTimeout(function() {
								self.css({
									'transform': 'translateY(' + thisTop + ')',
									'-ms-transform': 'translateY(' + thisTop + ')',
									'-moz-transform': 'translateY(' + thisTop + ')',
									'-webkit-transform': 'translateY(' + thisTop + ')',
									'-o-transform': 'translateY(' + thisTop + ')',
									'-ms-transition': setting.speed / 1000 + 's',
									'-moz-transition': setting.speed / 1000 + 's',
									'-webkit-transition': setting.speed / 1000 + 's',
									'-o-transition': setting.speed / 1000 + 's',
									'transition': setting.speed / 1000 + 's'
								})
							}, 1000);
						}
					} else {
						setting.iniAnimate = true;
						$(this).css({
							top: thisTop
						})
					}
				}
			})
		};
		var init = function($parent) {
			$parent.html(setNumDom(numToArr(setting.num)));
			runAnimate($parent)
		};
		this.resetData = function(num) {
			var newArr = numToArr(num);
			var $dom = $(this).find(".mt-number-animate-dom");
			if($dom.length < newArr.length) {
				$(this).html(setNumDom(numToArr(num)))
			} else {
				$dom.each(function(index, el) {
					$(this).attr("data-num", newArr[index])
				})
			}
			runAnimate($(this))
		};
		init($(this));
		return this
	}
})(jQuery);