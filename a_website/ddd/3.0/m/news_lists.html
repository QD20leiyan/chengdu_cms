<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>弹弹岛2</title>
	<link rel="stylesheet" href="./css/common.css">
	<link rel="stylesheet" href="./css/common01.css">
	<link rel="stylesheet" href="./css/news_lists.css">
	<link rel="stylesheet" href="./css/dropload.css">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
	<script>
		(function (doc, win) {
		  var docEl = doc.documentElement,
		    // 手机旋转事件,大部分手机浏览器都支持 onorientationchange 如果不支持，可以使用原始的 resize
		      resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
		      recalc = function () {
		        //clientWidth: 获取对象可见内容的宽度，不包括滚动条，不包括边框
		        var clientWidth = docEl.clientWidth;
		        if (!clientWidth) return;
		        docEl.style.fontSize = 16*(clientWidth / 320) + 'px';
		      };
		 
		  recalc();
		  //判断是否支持监听事件 ，不支持则停止
		  if (!doc.addEventListener) return;
		  //注册翻转事件
		  win.addEventListener(resizeEvt, recalc, false);
		 
		})(document, window);
	</script>
	<script src="./js/jquery-1.11.2.min.js"></script>
	<style>
		.d_news_list{height:auto;}
	</style>
</head>
<body>
	<div class="hengping"><p>请竖屏浏览</p></div>
	<script src="./js/top.js"></script>
	<div class="top_H"></div>
	<div class="d_news">
		<div class="d_news_header">新闻资讯</div>
		<div class="d_news_nav">
			<li class="textActive">资讯<span index="0" class="active"></span><i></i></li>
			<li>公告<span index="1"></span><i></i></li>
			<li>活动<span index="2" class=""></span><i></i></li>
			<li>攻略<span index="3"></span><i></i></li>
		</div>
		<div class="d_news_lists">
			<ul class="d_news_list">
				<!-- <li><span>关于游戏漏洞恶意刷道具处理办法如下所示</span><i>[05/28]</i></li></li> -->
			</ul>
			<ul class="d_news_list" style="display:none;"></ul>
			<ul class="d_news_list" style="display:none;"></ul>
			<ul class="d_news_list" style="display:none;"></ul>
			<!-- <div class="d_news_more"><div>查看更多</div></div> -->
		</div>
	</div>
	<script src="./js/dropload.min.js"></script>
<script>
	$(function(){
		//初始化
		//init(0);
		// function init(num){
		// 	$.ajax({
  //               type: 'GET',
  //               url: 'json/init.json',
  //               dataType: 'json',
  //               success: function(data){
  //               	console.log(data)
  //                   var result = '';
  //                   for(var i = 0; i < data.lists.length; i++){
  //                    	result += '<li><span>'+data.lists[i].title+'</span><i>['+data.lists[i].date+']</i></li>';
  //                   }
  //                   // 为了测试，延迟1秒加载
  //                   setTimeout(function(){
  //                      $('.d_news_list').eq(num).find(".dropload-down").before(result);
  //                       offLists();
  //                       toLists();
  //                       // 每次数据加载完，必须重置
  //                       me.resetload();
  //                       tab1LoadEnd = true;
  //                   },0);
  //               },
  //               error: function(xhr, type){
  //                   alert('Ajax error!');
  //                   // 即使加载出错，也得重置
  //                   me.resetload();
  //               }
  //           });   
		// }




		//下拉加载
	    var itemIndex = 0;
	    var tab1LoadEnd = false;
	    var tab2LoadEnd = false;
	    var tab3LoadEnd = false;
	    var tab4LoadEnd = false;
	    // tab
	    $('.d_news_nav li ').on('click', function(){
	        var $this = $(this);

	        $(".d_news_nav li").removeClass("textActive");
			$(this).addClass("textActive");

	        itemIndex = $this.find("span").attr("index");

	        $('.d_news_nav li').find("span").removeClass('active');
	        $this.find("span").addClass('active');
	        //console.log($this.addClass('liActive').parent("div"));
	       
	        $('.d_news_list').eq(itemIndex).show().siblings('.d_news_list').hide();

	        // 如果选中菜单一
	        if(itemIndex == '0'){
	            // 如果数据没有加载完
	            if(!tab1LoadEnd){
	                // 解锁
	                dropload.unlock();
	                dropload.noData(false);
	            }else{
	                // 锁定
	                dropload.lock('down');
	                dropload.noData();
	            }
	        // 如果选中菜单二
	        }else if(itemIndex == '1'){
	            if(!tab2LoadEnd){
	                // 解锁
	                dropload.unlock();
	                dropload.noData(false);
	            }else{
	                // 锁定
	                dropload.lock('down');
	                dropload.noData();
	            }
	        }else if(itemIndex == '2'){
	        	if(!tab3LoadEnd){
	                // 解锁
	                dropload.unlock();
	                dropload.noData(false);
	            }else{
	                // 锁定
	                dropload.lock('down');
	                dropload.noData();
	            }
	        }else if(itemIndex == '3'){
	        	if(!tab4LoadEnd){
	                // 解锁
	                dropload.unlock();
	                dropload.noData(false);
	            }else{
	                // 锁定
	                dropload.lock('down');
	                dropload.noData();
	            }
	        }
	        // 重置
	        dropload.resetload();
	    });

	    // dropload
	    var dropload = $('.d_news_list').dropload({
	        scrollArea : window,
	        loadDownFn : function(me){
            // 加载菜单一的数据
              	$.ajax({
                    type: 'GET',
                    url: 'json/init.json',
                    dataType: 'json',
                    success: function(data){

                    	console.log(data)
                        var result = '';
                        for(var i = 0; i < data.lists.length; i++){
                         	result += '<li><span>'+data.lists[i].title+'</span><i>['+data.lists[i].date+']</i></li>';
                        }
                        // 为了测试，延迟1秒加载
                        setTimeout(function(){
                           $('.d_news_list').eq(itemIndex).find(".dropload-down").before(result);
                            offLists();
                            toLists();
                            // 每次数据加载完，必须重置
                            me.resetload();
                            //tab1LoadEnd = true;
                        },1000);
                    },
                    error: function(xhr, type){
                        alert('Ajax error!');
                        // 即使加载出错，也得重置
                        me.resetload();
                    }
                });
	        }
	    });
	});

	function toLists(){
		$(".d_news_list li").on("click", function(e){
			e.stopPropagation();
			location.href="news_details.html";
		})
	}
	function offLists(){
		$(".d_news_list li").off();
	}
</script>
</body>
</html>