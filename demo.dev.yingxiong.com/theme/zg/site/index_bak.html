<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>{$seo_title}</title>
		<meta name="keywords" content="{$seo_key}" />
		<meta name="description" content="{$seo_desc}" />
		<link rel="shortcut icon" href="{$global.website_icon_img}?{$smarty.const.VERSION}" />
		<link rel="stylesheet" href="http://cdnstatic.yingxiong.com/common/css/yx.css"/>
		<link rel="stylesheet" href="{$smarty.const.STATIC_DOMAIN}1.0/css/swiper-3.4.2.min.css?{$smarty.const.VERSION}" />
		<link rel="stylesheet" href="http://static.dev.yingxiong.com/module/ddd_yy/css/tc_public.css?{$smarty.const.VERSION}" />
		<link rel="stylesheet" href="{$smarty.const.STATIC_DOMAIN}1.0/css/n_index.css?{$smarty.const.VERSION}" />
		<script src="{$smarty.const.STATIC_DOMAIN}1.0/js/jquery-1.11.2.min.js?{$smarty.const.VERSION}"></script>
				<script data-fixed="true">
			if((/iphone|android|mobile/i.test(navigator.userAgent.toLowerCase()))) {
				location.href = "/m" + window.location.pathname + window.location.search;
			}
		</script>
		<style>
			.news_lb_ul .hover-shadow{
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
			}
			.news_lb_ul .hover-shadow .del{
				width: 24px;
				height: 24px;
				background: url(http://static.dev.yingxiong.com/module/ddd_yy/images/news-del.png) no-repeat;
				position: absolute;
				top: -10px;
				right: -10px;
			}
			.news_lb_ul .hover-shadow .forbid{
				width: 22px;
				height: 22px;
				background: url(http://static.dev.yingxiong.com/module/ddd_yy/images/news-forbid.png) no-repeat;
				position: absolute;
				bottom: 0;
				left: 60px;
			}
			.news_lb_ul .hover-shadow .edit{
				width: 22px;
				height: 22px;
				background: url(http://static.dev.yingxiong.com/module/ddd_yy/images/news-edit.png) no-repeat;
				position: absolute;
				bottom: 0;
				right: 0;
			}
			.news-add-lb-mask{
				display: none;
			}
			.news-add-lb-main{
				width: 790px;
				height: 559px;
				background-color: #fff;
			    position: relative;
			    margin: 0 auto;
			    top: 45%;
			    transform: translate(0, -45%);
			    -webkit-transform: translate(0, -45%);
			    overflow: hidden;
			    border-radius: 5px;
			}
			.news-add-lb-main .close{
				width: 17px;
				height: 17px;
				background: url(http://static.dev.yingxiong.com/module/ddd_yy/images/close.png) no-repeat;
				position: absolute;
				top: 20px;
				right: 10px;
				cursor: pointer;
				z-index: 99;
			}
			.news-add-lb-btn{
				width: 189px;
				height: 46px;
				text-align: center;
				font-size: 20px;
				color:#fff;
				margin: 22px 0 0 297px;
				background: #428eff;
				border-radius: 5px;
				line-height: 46px;
			}
			.news-add-lb-main .news_lb_ul{
				height: 155px;
				overflow: hidden;
			}
			.news-add-lb-main .news_lb_ul li{
				margin: 0 30px 40px 173px;
			}
			.news_lb_ul.img_ul .gou{	
				display: block;
			}
			.news-add-lb-main .t_put .put_file.put_file_add{
				width: 560px;
				border:1px solid #e2e2e2;
			}
			.news-add-lb-main .t_put .put_file .selectbtn{
				border:0;
				padding-left: 16px;
				box-sizing: border-box;
				outline: none;
			}
			.news-add-lb-main .t_put{
				width: 100%;
			}
			.news-add-lb-main .open-type .self-window,.news-add-lb-main .open-type .new-window{
				width: 107px;
				height: 18px;
				line-height: 18px;
				display: inline-block;
				margin-top: 12px;
			}
			.news-add-lb-main .open-type .self-window{
				margin-right: 45px;
			}
			.news-add-lb-main .open-type-con p{
				border: 1px solid #e3e3e3;
				width: 18px;
				height: 18px;
				display: inline-block;
				text-align: center;
				line-height: 15px;
				margin-right: 20px;
				border-radius: 50%;
			}
			.news-add-lb-main .open-type-con span{
				width: 6px;
				height: 6px;
				background: #404040;
				display: none;
				border-radius: 50%;
			}
			.news-add-lb-main .open-type-con span.active{
				display: inline-block;
			}
			.news-add-lb-main .open-type-con i{
				display: inline-block;
				font-size: 14px;
				color: #000;
				font-style: normal;
			}
			.news-add-lb-main .sort_file.put_file{
				width: 205px;
				height: 44px;
				border:1px solid #e2e2e2;
			}
			.news-add-lb-main .show-or-no{
				margin-left: 90px;
				height: 46px;
				width: 260px;
				display: inline-block;
				line-height: 46px;
			}
			.news-add-lb-main .show-no-icon>span{
				width: 57px;
				height: 25px;
				display: inline-block;
				vertical-align: middle;
			}
			/*.news-add-lb-main .switch-on{
				background: url(http://static.dev.yingxiong.com/module/ddd_yy/images/switch-on.png) no-repeat;
				margin-right: 43px;
			}
			.news-add-lb-main .switch-on.active{
				background: url(http://static.dev.yingxiong.com/module/ddd_yy/images/switch-on-active.png) no-repeat;
			}*/
			.news-add-lb-main .switch-off{
				background: url(http://static.dev.yingxiong.com/module/ddd_yy/images/switch-off.png) no-repeat;
			}
			.news-add-lb-main .switch-off.active{
				background: url(http://static.dev.yingxiong.com/module/ddd_yy/images/switch-on-active.png) no-repeat;
			}
			.news-add-lb-main .edit-img{
				display: none;
			}
			.news-add-lb-main .edit-img{
				width: 287px;
				height: 120px;
				margin:0 auto;
				margin: 50px auto 50px ;
				position: relative;
			}
			.news-add-lb-main .swiper-container{
				width: 120px!important;
				height: 120px;
			}
			.news-add-lb-main .edit-img .swiper-slide{
				width: 120px!important;
				height: 120px;
				line-height: 120px;
				box-sizing: border-box;
				border: 1px solid #e2e2e2;
			}
			.news-add-lb-main .edit-img img{
				width: 100%;
				max-height: 100%;
				margin:0;
				vertical-align: middle;
			}
			.news-add-lb-main .edit-img .swiper-button-prev,.news-add-lb-main .edit-img .swiper-button-next{
				width: 22px;
				height: 40px;
			}
			.news-add-lb-main .edit-img .swiper-button-prev{
				background: url(http://static.dev.yingxiong.com/module/ddd_yy/images/news-prev.png) no-repeat; 
			}
			.news-add-lb-main .edit-img .swiper-button-next{
				background: url(http://static.dev.yingxiong.com/module/ddd_yy/images/news-next.png) no-repeat; 
			}
			.article-pic{
			    padding: 18px 0 0 98px;
			    width: 552px;
			    height: 192px;
			    box-sizing: border-box;
			    overflow: scroll;
			}
			.article-pic::-webkit-scrollbar{
				display: none;
			}
			.article-pic li{
				width: 120px;
				height: 120px;
				position: relative;
				float: left;
				margin-right: 15px;
				margin-bottom: 10px;
			}
			.article-pic i.del{
				width: 24px;
				height: 24px;
				position: absolute;
				top: -10px;
				right: -10px;
				display: inline-block;
				background: url(http://static.dev.yingxiong.com/module/ddd_yy/images/news-del.png) no-repeat; 
			}
			.article-pic i.gou{
				width: 24px;
				height: 24px;
				position: absolute;
				top: -10px;
				right: -10px;
				display: inline-block;
				background: url(http://static.dev.yingxiong.com/module/ddd_yy/images/gou.png) no-repeat; 
			}
			.article-pic li img{
				width: 100%;
				height: 100%;
			}
			.article-content{
			    width: 830px;
    			height: 291px;
    			padding: 70px 0 0 0;
    			margin:0 auto;
    			box-sizing: border-box;
			}
			.article-content .w-e-text-container{
				height: 273px!important;
			}
			.editor-btn{
			    margin: 98px auto 83px!important;
			}
			.article-content p{
				width: 100%!important;
			}
			#dropdown-ul{
				z-index: 10;
				background: #fff;
			}
			.tail_btn{
			    margin: 43px auto 83px!important;
			}
			#tail_ul{
				height: 322px;
				overflow: scroll;
			}
			#tail_ul::-webkit-scrollbar{
				display: none;
			}
			.img_ul li img{
				max-width: 100%;
				max-height: 100%;
			}
			.article_tc .add_con>div{
				overflow: hidden;
			}
			input::-webkit-outer-spin-button,
			input::-webkit-inner-spin-button {
			    -webkit-appearance: none;
			}
			input[type="number"] {
			    -moz-appearance: textfield;
			}
			.add_put .dropdown{
				width: 190px;
			}
			.add_put .add_title{
				width: 430px;
			}
			.article_tc .btn_list{
				margin: 207px auto 83px;
			}
			.news_lb_ul li span.show{
				position: absolute;
				bottom: -25px;
				display: block;
				text-align: center;
				width: 100%;
			}
			#news_lb_ul li{
				height: 125px;
			}
			.show-img-tc .t_close{
				display: block;
			    width: 17px;
			    height: 17px;
			    float: right;
			    margin: 19px 20px 0 0;
			    transition: all .5s;
			    -webkit-transition: all .5s;
			    cursor: pointer;
			}
			.show-img-tc .add_wrap{
				text-align: center;
				line-height: 570px;
				background: transparent;
			    width: 500px;
    			height: auto;
			}
			.show-img-tc .add_wrap .show-img{
				width: 500px;
				max-height: 700px;
				vertical-align: middle;
				display: block;
			}
		</style>
	</head>

	<body>
		<!-- 新闻  轮播图 -->
		<div class="ts_tc" style="display: block;">
			<div class="ts_wrap">
				<p class="tc_title"><span>编辑模块</span><img src="http://static.dev.yingxiong.com/module/ddd_yy/images/close.png" alt="" class="t_close" /></p>
				<div class="m_wrap">
					<div class="l_menu">
						<ul>
							<li class="active">轮播图</li>
							<li>新闻</li>
						</ul>
					</div>
					<div class="r_kv">
						<div class="r_con_div active">
							<div class="t_put">
								<p>轮播图</p>
								<div class="put_file">
									<input class="selectbtn news-add-lb-tap" type="text"  style="opacity: 0;">
									<a href="javascript:;" class="put_link news_put_link">+&nbsp;新增轮播图</a>
								</div>
							</div>
							<ul id="news-img-list" class="img_ul news_lb_ul"></ul>
						</div>
						<div class="r_con_div ">
							<div class="t_put">
								<input type="text" class="search search-article" placeholder="搜索文章" />
								<div class="add_tail">添加文章</div>
							</div>
							<ul class="tail_ul" id="tail_ul"></ul>
							<div class="btn_list tail_btn">
								<a href="javascript:;">确定</a>
								<!-- <a href="javascript:;">取消</a> -->
							</div>
						</div>
					</div>
				</div> 
			</div>
		</div>
		<div class="ts_tc news-add-lb-mask" style="display: none;">
			<div class="news-add-lb-main m_wrap">
				<a href="javascript:;" class="close"></a>
				<p class="tc_title"><span>新增轮播图</span></p>
				<div class="t_put upload-img">
					<p>上传图片</p>
					<div class="put_file">
						<input class="selectbtn" type="file" name="fileselect[]" multiple="" accept="jpg,png,exe,gif,GIF,JPG,PNG" style="opacity: 0;" id="news_lb_file">
						<a href="javascript:;" class="put_link news_put_link">+&nbsp;点击上传图片,200*200px,jpg格式</a>
					</div>
				</div>
				<div class="edit-img">
					<div class="swiper-container">
						<ul class="swiper-wrapper">
						
						</ul>
					</div>
					
					<div class="swiper-button-prev"></div>
					<div class="swiper-button-next"></div>
				</div>
				<ul id="news_lb_ul" class="img_ul news_lb_ul"></ul>
				<div class="t_put">
					<p>跳转链接</p>
					<div class="put_file put_file_add">
						<input class="selectbtn url" type="text"   placeholder="外链请录入完整地址，如：http://www.baidu.com;内网地址需录入：/aaa.html;">
					</div>
				</div>
				<div class="t_put open-type">
					<p>打开方式</p>
					<div class="open-type-con">
						<div class="self-window" data-type="0">
							<p><span class="active"></span></p>
							<i>当前窗口</i>
						</div>
						<div class="new-window" data-type="1">
							<p><span></span></p>
							<i>新窗口</i>
						</div>
					</div>
				</div>
				<div class="t_put">
					<p>排序</p>
					<div class="put_file sort_file">
						<input class="selectbtn sort" type="number"   placeholder="输入数字，数字大的在前面">
					</div>
					<div class="show-or-no">
						<p>是否显示</p>
						<div class="show-no-icon">
							<!-- <span class="switch-on" data-switch="1"></span> -->
							<span class="switch-off active" data-switch="1"></span>
						</div>
					</div>
				</div>
				<div class="news-add-lb-btn">确定</div>
			</div>
		</div>
		<!--添加文章弹窗-->
		<div class="add_tc article_tc" style="display: none;">
			<div class="add_wrap">
				<p class="tc_title"><span class="article-tc-title">添加文章</span><img src="http://static.dev.yingxiong.com/module/ddd_yy/images/close.png" alt="" class="t_close article-close" /></p>
				<div class="add_ul">
					<ul>
						<li class="active">基本属性</li>
						<li class="">文章内容</li>
					</ul>
				</div>
				<div class="add_con">
					<div class="add_div active">
						<div class="add_put">
							<p>文章分类</p>
							<div class="dropdown">
								<input type="text" value="" readonly="readonly" class="new_input_select" />
								<img src="http://static.dev.yingxiong.com/module/ddd_yy/images/dao.png" alt="" class="dao" />
								<ul id="dropdown-ul"></ul>
							</div>
							<p class="add_p">文章标题</p>
							<input type="text" class="add_title article-title" />
						</div>
						<div class="add_put">
							<p>录入时间</p>
							<input type="text" class="add_date" placeholder="" />
							<p class="add_b">来源</p>
							<input type="text" class="add_from article-from" placeholder="官方" />
							<p>文章排序</p>
							<input type="number" class="add_num article-num" placeholder="数字大的在前面" />
						</div>
						<div class="add_put">
							<p>缩略图</p>
							<div class="put_file" >
								<input class="selectbtn" type="file" name="fileselect[]" multiple="" accept="jpg,png,exe,gif,GIF,JPG,PNG" style="opacity: 0;" id="article-pic-file">
								<a href="javascript:;" class="put_link">点击上传缩略图，120px*120px最佳</a>
							</div>
							<ul class="article-pic" id="article-pic"></ul>
						</div>
						<div class="btn_list">
							<a href="javascript:;" class="add-article-sure">确定</a>
							<!-- <a href="javascript:;" class="add-article-cancel">取消</a> -->
						</div>
					</div>
					<div class="add_div">
						<div class="add_put">
							<p class="title">简介</p>
							<input type="text" class="add_jj article-desc" />
							<div class="article-content"></div>
							<div class="btn_list editor-btn">
								<a href="javascript:;" class="add-article-sure">确定</a>
								<!-- <a href="javascript:;" class="add-article-cancel">取消</a> -->
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- 预览弹窗 -->
		<div class="add_tc show-img-tc" >
			<div class="add_wrap">
				<img src="" alt="" class="show-img">
			</div>
		</div>
	</body>
	<!-- <script src="http://cdnstatic.yingxiong.com/common/js/yx.js?{$smarty.const.VERSION}"></script> -->
	<script type="text/javascript" src="{$smarty.const.STATIC_DOMAIN}1.0/js/swiper-3.4.2.min.js?{$smarty.const.VERSION}"></script>
	<script src="http://static.dev.yingxiong.com/module/ddd_yy/js/wangEditor.min.js"></script>
	<script type="text/javascript">
		var alt = "{module_api_domain}/";
	</script>
	<script type="text/javascript">

		$(function() {
			var img_url = "";
			var img_list = [];
			var article_id = null; //文章id
			var E = window.wangEditor;
			var editor = new E('.article-content');
			function init(index){ //初始化数据
				$(".put_file_add input").val(img_list[index].url);
				$(".sort_file input").val(img_list[index].sort);
				if(img_list[index].target == 1){ //新窗口
					$(".open-type-con span").removeClass("active");
					$(".open-type-con .new-window span").addClass("active");
				}else{
					$(".open-type-con span").removeClass("active");
					$(".open-type-con .self-window span").addClass("active");
				}
				if(img_list[index].status == 1){ //显示
					$(".show-no-icon .switch-off").addClass("active");
					$(".show-no-icon .switch-off").attr("data-switch",'1');
				}else{
					$(".show-no-icon .switch-off").removeClass("active");
					$(".show-no-icon .switch-off").attr("data-switch",'0')
				}
			}
			var mySwiper = new Swiper(".swiper-container", {
				pagination: '.swiper-pagination',
				loop: false,
				autoplay: 0,
				observer: true,
				// initialSlide:$(obj).index(),
				observeParents: true,
				prevButton: '.swiper-button-prev',
				nextButton: '.swiper-button-next',
				onSlideChangeEnd:function(){
					init(mySwiper.activeIndex);
				}
			});
			$("body").click(function(e){
				if(e.target != $(".dropdown input")[0]){
					$(".dropdown ul").hide();
				}
			})
			$(".show-img-tc").click(function(e){
				if(e.target == $(".show-img-tc")[0]){
					$(".show-img-tc").hide();
				}
			})
			var _date = new Date();
			var year = _date.getFullYear();
			var month = (_date.getMonth()+1) >= 10 ? (_date.getMonth()+1) : ('0'+ (_date.getMonth()+1));
			var day = _date.getDate() >= 10 ? _date.getDate() : '0' + _date.getDate();
			var hour = _date.getHours() >= 10 ? _date.getHours() : '0' + _date.getHours();
			var minute = _date.getMinutes() >= 10 ? _date.getMinutes() : '0' + _date.getMinutes();
			var time = year + '/' + month + '/' + day + '    ' + hour + ':' + minute;
			$(".add_date").val(time);

			function $ajax(url,params,callback){
				$.ajax({
					url: alt + url,
					type: 'POST',
					async: true,
					xhrFields: {
						withCredentials: true
					},
					data: params,
					success: function(data) {
						if(data.status == 0){
							callback(data);
						}
					},
					error: function() {}
				});
			}
			//拉取用户信息
			$.ajax({
				url: alt + "moduleapi/login/get-user-info",
				type: 'POST',
				async: true,
				xhrFields: {
					withCredentials: true
				},
				data: {

				},
				success: function(respon) {
					var data = eval(respon);
					img_url = data.data.imgapi;
					// 富文本编辑器
					// 关闭粘贴内容中的样式
					editor.customConfig.pasteFilterStyle = false;
					editor.customConfig.uploadImgServer = img_url;
					editor.customConfig.uploadFileName = 'file';
				 	// editor.customConfig.uploadImgShowBase64 = true;
					// editor.customConfig.debug = true;
					editor.customConfig.menus = [
				        'head',  // 标题
					    'bold',  // 粗体
					    'fontSize',  // 字号
					    'fontName',  // 字体
					    'italic',  // 斜体
					    'underline',  // 下划线
					    'strikeThrough',  // 删除线
					    'foreColor',  // 文字颜色
					    'backColor',  // 背景颜色
					    'link',  // 插入链接
					    'list',  // 列表
					    'justify',  // 对齐方式
					    'quote',  // 引用
					    'emoticon',  // 表情
					    'image',  // 插入图片
					    'table',  // 表格
					    // 'video',  // 插入视频
					    'code',  // 插入代码
					    'undo',  // 撤销
					    'redo'  // 重复
				    ];
    				editor.customConfig.showLinkImg = false; // 隐藏“网络图片”tab
					editor.customConfig.uploadImgTimeout = 50000;
					editor.customConfig.uploadImgHooks = {
					    before: function (xhr, editor, files) {
					     
					    },
					    success: function (xhr, editor, result) {
					       
					    },
					    fail: function (xhr, editor, result) {

					    },
					    error: function (xhr, editor) {
					      
					    },
					    timeout: function (xhr, editor) {
					       
					    },
					    customInsert: function (insertImg, result, editor) {
					        var url = result.cdn_url
					        insertImg(url);
					    }
					}
					editor.create();
					
					
				},
				error: function() {}
			});

			//添加edit蒙层
			function hover_shadow(obj,parent){
				$(obj).find(".gou").hide();
				var ele = '<div class="hover-shadow"><i class="del"></i><i class="edit"></i><i class="forbid"></i></div>';
				if($(obj).find(".hover-shadow").length==0){
					$(obj).append(ele);
				}
				$(".hover-shadow .edit").off("click").on("click",function(){ //编辑轮播图
					var index = $(obj).index();
					$(".news-add-lb-mask").show();
					$(".news-add-lb-main .tc_title span").html("编辑图片");
					$(".news-add-lb-main .upload-img").hide();
					$(".news-add-lb-main .edit-img").show();
					$(".news-add-lb-main #news_lb_ul").hide();
					
					init(index);
					mySwiper.slideTo($(obj).index(), 1, false);//切换到第一个slide，速度为1秒
					// function swiper_btn(){

					// }
				})
				var index = $(obj).index();
				var status = null; //禁止不显示
				var url = img_list[index].url;
				var sort = img_list[index].sort;
				var target = img_list[index].target;
				var id = img_list[index].id;
				var img = img_list[index].thumb;
				$(obj).off("click").on("click",function(){ //选中轮播图
					status = 1; //显示
					$ajax("moduleapi/fragment/update-lunbo",{
						url:url,
						target:target,
						sort:sort,
						status:status,
						img:img_url,
						id:id
					},function(data){
						if(data.status == 0){
							if($(obj).find(".gou").length == 0){
								$(obj).append('<i class="gou"></i>');
							}else{
								$(obj).find(".gou").show();
							}
							getLb();
						}
					})
				})
				$(".hover-shadow .del").off("click").on("click",function(){ //删除轮播图
					var index = $(obj).index();
					var id = $(obj).attr("data-id");
					$ajax("moduleapi/fragment/delete-lunbo",{
						id:id
					},function(data){
						if(data.status == 0){
							$("#news-img-list li").eq(index).remove();
							getLb();
						}
					})
				})
				$(".hover-shadow .forbid").off("click").on("click",function(e){ //禁止轮播图
					e.stopPropagation();
					status = 0; //禁止不显示
					$ajax("moduleapi/fragment/update-lunbo",{
						url:url,
						target:target,
						sort:sort,
						status:status,
						img:img_url,
						id:id
					},function(data){
						if(data.status == 0){
							$(obj).find(".gou").remove();
							getLb();
						}
					})
				})
			}
			//获取新闻轮播图
			function getLb() {
				$("#news-img-list").empty();
				$(".news-add-lb-main .edit-img ul").empty();
				$ajax("moduleapi/fragment/get-lunbo-list",{},function(data){
					var data = eval(data);
					img_list = data.data.data;
					var html = "";
					var _slide = "";
					for(var i in data.data.data) {
						html += '<li data-id=' + data.data.data[i].id + '><img src=' + data.data.data[i].thumb + ' /><i class="gou"></i><span class="show">预览</span></li>';
						_slide += '<li class="swiper-slide" data-id=' + data.data.data[i].id + '><img src="' + data.data.data[i].thumb + '" alt="" /></li>';
						
					};
					$(".news-add-lb-main .edit-img ul").append(_slide);
					$("#news-img-list").append(html);
					img_list.map(function(val,i){
						if(val.status == 1){
							$("#news-img-list li").eq(i).find(".gou").show();
						}else{
							$("#news-img-list li").eq(i).find(".gou").hide();
						}
					})
					$("#news-img-list li").mouseenter(function(){
						hover_shadow($(this),$("#news-img-list"));
					}).mouseleave(function(){
						if(img_list[$(this).index()].status == 1){
							$(this).find(".gou").show();
						}
						$(this).find(".hover-shadow").remove();
					})
					$(".show").click(function(){ //预览
						$(".show-img-tc").show();
						$(".show-img").attr("src",$(this).parent().find("img").attr("src"));
					})
				});
			};
			getLb();
			// 新增轮播图
			var target = $(".open-type-con span.active").parent().parent().attr("data-type"); //窗口打开方式
			var url = ""; //跳转链接
			var sort = null; //排序
			var status = $(".show-no-icon span").attr("data-switch"); //是否显示
			var img_src= ""; //上传图片地址
			var id = null; //修改轮播图时候的id
			$(".news-add-lb-main .open-type-con div").click(function(){
				target = $(this).attr("data-type");
				$(".news-add-lb-main .open-type-con span").removeClass("active");
				$(this).find("span").addClass("active");
			})
			$(".show-no-icon span").click(function(){
				if($(this).hasClass("active")){ //开启
					$(this).removeClass("active");
					$(this).attr("data-switch",0);
				}else{
					$(this).addClass("active");
					$(this).attr("data-switch",1);
				}
				status = $(this).attr("data-switch");
			})
			// 编辑轮播和添加
			$(".news-add-lb-btn").click(function(){
				url = $(".news-add-lb-main .url").val();
				sort = $(".news-add-lb-main .sort").val();
				if($(".edit-img").is(":visible")){ //编辑图片
					id = $(".edit-img li").eq(mySwiper.activeIndex).attr("data-id");
					img_src = $(".edit-img li.swiper-slide-active img").attr("src");
					$ajax("moduleapi/fragment/update-lunbo",{
						url:url,
						target:target,
						sort:sort,
						status:status,
						img:img_src,
						id:id
					},function(data){
						if(data.status == 0){
							$(".news-add-lb-mask").hide();
							getLb();
						}
					})
				}else{ //新增图片
					img_src = $("#news_lb_ul img").attr("src");
					$ajax("moduleapi/fragment/create-lunbo",{
						url:url,
						target:target,
						sort:sort,
						status:status,
						img:img_src
					},function(data){
						if(data.status == 0){
							$(".news-add-lb-mask").hide();
							getLb();
						}
					})
				}
				
				
			})
			// 新增轮播图
			$(".news-add-lb-tap").click(function(){
				$('#news_lb_ul').empty();
				$(".put_file_add input").val("");
				$(".open-type-con span").removeClass("active");
				$(".open-type-con .self-window span").addClass("active");
				$(".sort_file input").val("");
				// $(".show-no-icon span").removeClass("active");
				$(".news-add-lb-mask").show();
				$(".news-add-lb-main .tc_title span").html("新增轮播图");
				$(".news-add-lb-main .upload-img").show();
				$(".news-add-lb-main .edit-img").hide();
				$(".news-add-lb-main #news_lb_ul").show();	
			})
			$(".news-add-lb-main .close").click(function(){
				$(".news-add-lb-mask").hide();
			})

			// 上传轮播图
			function upload_img(e,img_url,obj,type){ // type : 是显示一张图片还是多张图片
				var result = e.currentTarget.files[0];
				var oData = new FormData();
				oData.append("file", result);
				$.ajax({
					url: img_url,
					type: 'POST',
					cache: false, //不设置缓存
					processData: false, // 不处理数据
					contentType: false, // 不设置内容类型
					data: oData,
					dataType: 'json',
					success: function(data) {
						var html = "";
						if(type == 'single'){ // 轮播上传
							html += '<li data-id=' + data.id + '><img src=' + data.cdn_url + ' /><i class="gou"></i><span class="show">预览</span></li>';
							$(obj).html(html);
							$(".show").click(function(){
								$(".show-img-tc").show();
								$(".show-img").attr("src",data.cdn_url);
							})
						}else{ //新闻上传
							var _each = {
								"src":null,
								"name":null
							}
							// data-name 为上传图片的name
							html += '<li data-id=' + data.id + ' data-select="1" data-name="'+result.name+'"><img src=' + data.cdn_url + ' /></li>';
							$(obj).prepend(html);
							$(obj).find("li:first").append("<i class='gou'></i>").siblings().find('i.gou').remove();
							$(obj).find("li").mouseenter(function(){
								var _this = this;
								if($(_this).find("i.del").length == 0 && $(_this).attr("data-select") == 0){
									$(_this).append("<i class='del'></i>");
								}
								$(_this).find("i.del").click(function(){
									$(_this).remove();
								})
							}).mouseleave(function(){
								$(this).find('i.del').remove();
							})
							$(obj).find("li").click(function(){
								var _this = this;
								$(_this).find('i.del').remove();
								$(_this).append("<i class='gou'></i>");
								$(_this).attr("data-select","1");
								$(_this).siblings().find('i.gou').remove();
								$(_this).siblings().attr("data-select","0");
							})
						}
					},
					error: function() {
						console.log("Error！");
					}
				});
			}
			$("#news_lb_file").on('change', function(e) {
				upload_img(e,img_url,$("#news_lb_ul"),'single');
			});
			$("#article-pic-file").on('change',function(e){
				upload_img(e,img_url,$("#article-pic"),'more');
			})

			//-------------------------------- 新闻相关---------------------------------------
			var article_type = []; //文章分类
			$(".add_ul li").click(function(){
				var index = $(this).index();
				$(this).addClass("active").siblings().removeClass("active");
				$(".add_con .add_div ").eq(index).addClass("active").siblings().removeClass("active");
			})
			$(".article-close").click(function(){
				$(".article_tc").hide();
				$(".add_ul li").eq(0).addClass("active").siblings().removeClass("active");
				$(".add_con .add_div").eq(0).addClass("active").siblings().removeClass("active");
			})
			$(".add_tail").click(function(){
				$(".dropdown input").val(article_type[0]);
				$(".dropdown input").attr("data-id",Object.keys(article_type)[0]);
				$(".article-title").val("");
				$(".article-from").val("");
				$(".article-num").val("");
				$("#article-pic").empty();
				$(".article-desc").val("");

				$(".article-tc-title").html("添加文章");
				$(".article_tc").show();
				$(".add-article-cancel").click(function(){
					$(".article_tc").hide();
					$(".add_ul li").eq(0).addClass("active").siblings().removeClass("active");
					$(".add_con .add_div").eq(0).addClass("active").siblings().removeClass("active");
				})
			})
			//--------------- 添加文章---------------
			$(".dropdown input").click(function(){
				$(".dropdown ul").toggle();
				$("#dropdown-ul li").click(function(e){
					$(".dropdown ul").hide();
					e.stopPropagation();
					$(".dropdown input").val($(this).html());
					$(".dropdown input").attr("data-id",$(this).attr("data-id"));
				})
			})
			// 新增文章 或者编辑文章
			$(".add-article-sure").click(function(){
				var category_id = $(".dropdown input").attr("data-id"); //文章分类
				var title = $(".article-title").val();
				var sub_title = $(".article-from").val();
				var sort = $(".article-num").val();
				var thumb = "";
				var formData = new FormData();
				$("#article-pic li").map(function(i,val){
					if($(val).attr("data-select") == 1){
						thumb = $(val).find("img").attr("src");
						formData.append('article_log[1][name]', $(val).attr("data-name"));
						formData.append('article_log[1][img]', $(val).find("img").attr("src"));
					}
				})
				var summary = $(".article-desc").val(); //简介
				var content = editor.txt.html(); //内容
				var id = article_id;
				formData.append('category_id',category_id);
				formData.append('title',title);
				formData.append('sub_title',sub_title);
				formData.append('sort',sort);
				formData.append('thumb',thumb);
				formData.append('summary',summary); //简介
				formData.append('content',content);
				formData.append('id',id);
				if(category_id == 0){
					alert("请选择分类");
					return false;
				}else if(title == ''){
					alert("请填写文章标题");
					return false;
				}else if(summary == ''){
					alert("请填写简介");
					return false;
				}else if(thumb == ''){
					alert("请上传缩略图");
					return false;
				}
				function article_operation(url){
					$.ajax({
						url:alt + url,
						type:'POST',
						dataType:"json",
						xhrFields: {
							withCredentials: true
						},
						traditional: true,
						processData: false,
						contentType: false,
						data:formData,
						success:function(data){
							page = 1;
							add_article(page,'');
							$(".article_tc").hide();
							$(".add_ul li").eq(0).addClass("active").siblings().removeClass("active");
							$(".add_con .add_div").eq(0).addClass("active").siblings().removeClass("active");
						}
					})
				}
				if($(".article-tc-title").html() == '添加文章'){
					article_operation('/moduleapi/content/create-article');
				}else if($(".article-tc-title").html() == '编辑文章'){
					article_operation('/moduleapi/content/update-article');
				}
				
			})
			


			// 搜索文章
			$(".search-article").keyup(function(){
				if($(".search-article").val() != ''){
					page = 1;
					add_article(page,$(".search-article").val());
				}else{
					page = 1;
					add_article(page,"");
				}
			})

			// 获取文章列表
			var page = 1;
			var scroll_list = [];
			function add_article(page,arc_keywords){
				$ajax('/moduleapi/content/get-article-list',{
					page:page,
					keywords:arc_keywords
				},function(data){
					$("#tail_ul").empty();
					scroll_list = data.data;
					if(scroll_list.length == 0){
						return false;
					}
					$("#article-pic").empty();
					var list = data.data;
					var ele = '';
					list.map(function(val,i){
						ele += '<li data-id="'+ list[i].id +'"><span>'+ list[i].title +'</span><img src="http://static.dev.yingxiong.com/module/ddd_yy/images/h_close.png" alt="" class="del-article"></li>'
					})
					$("#tail_ul").append(ele);
					$("#tail_ul .del-article").click(function(){
						var _this = this;
						$ajax('/moduleapi/content/delete-content',{
							id:$(_this).parent().attr("data-id")
						},function(data){
							$("#tail_ul li").eq($(_this).parent().index()).remove();
						})
					})
					$("#tail_ul li span").click(function(){ //编辑文章
						article_id = $(this).parent().attr("data-id");
						$("#article-pic").empty();
						$(".article_tc").show();
						$(".article-tc-title").html("编辑文章");
						$ajax('/moduleapi/content/get-article-info',{
							id:article_id
						},function(data){
							var _data = data.data.data;
							var categoryList = data.data.categoryList;
							var img_log = data.data.img_log;
							for(var key in categoryList){
								if(_data.category_id == key){
									$(".dropdown input").val(categoryList[key]);
								}
							}
							$(".dropdown input").attr("data-id",_data.category_id); //文章分类
							$(".article-title").val(_data.title);
							$(".article-from").val(_data.sub_title);
							$(".article-num").val(_data.sort);
							var ele = '';
							img_log.map(function(val,i){
								ele += '<li data-select="0" data-id="'+ val.id +'"><img src=' + val.img  + ' /></li>';
							})
							$("#article-pic").append(ele);
							$("#article-pic li:first").attr("data-select",1);
							$("#article-pic li:first").append("<i class='gou'></i>");
							$(".article-desc").val(_data.summary);
							editor.txt.html(_data.body);
							$("#article-pic").find("li").mouseenter(function(){
								var _this = this;
								if($(_this).find("i.del").length == 0 && $(_this).attr("data-select") == 0){
									$(_this).append("<i class='del'></i>");
								}
								$(_this).find("i.del").click(function(){
									$ajax('/moduleapi/common/delete-img-log',{
										id:$(_this).attr("data-id")
									},function(data){
										$(_this).remove();
									})
								})
							}).mouseleave(function(){
								$(this).find('i.del').remove();
							})
							$("#article-pic").find("li").click(function(){
								var _this = this;
								$(_this).find('i.del').remove();
								$(_this).append("<i class='gou'></i>");
								$(_this).attr("data-select","1");
								$(_this).siblings().find('i.gou').remove();
								$(_this).siblings().attr("data-select","0");
							})
						})
					})
					
				})
			}
			
			$("#tail_ul").scroll(function(){
			 	var scrollTop = $(this).scrollTop();    //滚动条距离顶部的高度
			 	var scrollHeight = $("#tail_ul li").height()*$("#tail_ul li").length;   //当前页面的总高度
			 	var clientHeight = $(this).height();    //当前可视的页面高度
			 	if(scrollTop + clientHeight >= scrollHeight){  
				 	if(scroll_list.length != 0){
				 		page++;
			 			add_article(page,"");
				 	} 	
			 	}else if(scrollTop<=0){ 
				 	
			 	}
			});
			//左侧导航栏切换
			$(".l_menu ul li").click(function() {
				var index = $(this).index();
				$(this).addClass("active").siblings().removeClass("active");
				$(".r_kv>div").eq(index).addClass("active").siblings().removeClass("active");
				if($(this).html() == "新闻"){
					add_article(page,"");
					//获取文章分类 
					$ajax('/moduleapi/category/get-article-list',{},function(data){
						var list = data.data;
						article_type = data.data;
						var ele = "";
						for(var key in list){
							ele += '<li data-id="'+ key +'">'+ list[key] +'</li>';
						}
						$(".dropdown ul").append(ele);
						$(".dropdown input").val(list[0]);
						$(".dropdown input").attr("data-id",Object.keys(list)[0]);
					})
				}
			});
			
		});
	</script>

</html>