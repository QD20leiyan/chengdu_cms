{include '../layouts/pc/header.html'}
<div class="wrap">
	{include '../layouts/pc/header_bar.html'}
	<!--news-list-->
	<div class="new-list-wrap">
		<ul class="event-list-news"></ul>
		<div class="loading hidden"></div>
		<div class="no_txt hidden"></div>
	</div>
	<!--fixed-->
	<div class="li-fixed">
		<span class="label same_title">
			<img src="{$smarty.const.STATIC_DOMAIN}3.0/images/ab-border.png?{$smarty.const.VERSION}" alt=""/>
			<span class="c_name">公司动态</span>
			<span class="e_name">NEWS</span>
		</span>
		<div class="li-year">
			<p>YEARS</p>
			<h2 id="year" data-year=""></h2>
			<div class="page">
				<span class="prev fl"></span>
				<span class="next fl"></span>
			</div>
		</div>
	</div>
</div>
{include '../layouts/pc/foot.html'}
<script type="text/javascript">
	var isScroll = 1;//是否可以滚动
	var page = 1; //页数
	var id = 242;//类型
//	$("#year").text(new Date().getFullYear());
	$("#year").data("year",new Date().getFullYear());
	var ajaxUrl = '/commonMethod/ajax-get-list.html';
	getListFu(true);
	window.onscroll=function(){
		var winH = window.innerHeight; //屏幕高度
		var allH = document.body.scrollHeight; //总高度
		var topH = window.pageYOffset; //滚动高度
		if(allH>0&&(allH - (winH
				+ topH)<10) && isScroll == 1){
			isScroll = 0;
			$(".loading").removeClass("hidden");
			getListFu();
		}
	}
	function getListFu(isfirst){
		var year=$("#year").data("year");
		$.ajax({
			type:"get",
			url:ajaxUrl,
			data:{
				page:page++,
				id:id,
				year:year,
				page_size:10,
			},
			success:function(data){
				var data = JSON.parse(data);
				if(data.status == 0&& data.msg.length>0){
					var result = '';
					if($("#year").text()!=year){
						$('.event-list-news').empty();
						$("#year").text(year);
						$("html,body").stop().animate({ scrollTop:"0px" },300);
					}
					for(var i = 0; i < data.msg.length; i++) {
						result += "<li><a href="+ data.msg[i].linkUrl+" target='_blank'>"+
						"<img src="+ data.msg[i].thumb+"><h2>" +data.msg[i].title+"</h2><p class='tit'>"+data.msg[i].created_at+"</p>"+
						"<p class='txt'>" +data.msg[i].contentMessage+"</p></a></li>";
					}
					$('.event-list-news').append(result);
					$(".loading").addClass("hidden");
					isScroll = 1;
				}else if(data.status == 0){
				//进页面加载无数据请求前一年
					if(isfirst){
						var datayear=$("#year").data("year")-1;
						$("#year").data("year",datayear);
						page=1;
						getListFu(true);
					}else{
						if($("#year").text()!=year){
//							alert("暂无数据");
							$(".loading").addClass("hidden");
						}else{
							$(".no_txt").removeClass("hidden");
							$(".no_txt").text("没有数据了哦~");
							$(".loading").addClass("hidden");
						}
					}
				}
			},
			error:function(data){
				console.log(data);
			}
		});
	}

	$(".page .prev").click(function(){
		var datayear=$("#year").text()-1;
		$("#year").data("year",datayear);
		page=1;
		$(".no_txt").addClass("hidden");
		getListFu();
	});
	$(".page .next").click(function(){
		var datayear=$("#year").text()-(-1);
		$("#year").data("year",datayear);
		page=1;
		$(".no_txt").addClass("hidden");
		getListFu();
	});
</script>
</html>